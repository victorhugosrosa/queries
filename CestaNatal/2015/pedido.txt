SELECT 
	PEDIDO.IDPEDIDO
	,FORMA_PAGAMENTO.DESCRICAO AS DESCRICAO_FORMA_PAGAMENTO
	,USUARIO.NOME AS NOME_USUARIO
	,CLIENTE.CNPJCPF
	,PESSOA.NOME_PESSOA
	,PESSOA.EMAIL
	--,PEDIDO.[IDMOTIVO_FINANCEIRO]
	,MOTIVO_FINANCEIRO.DESCRICAO AS DESCRICAO_MOTIVO_FINANCEIRO
	,PEDIDO.[NUMERO_NOTA_FISCAL]
	,PEDIDO.[DATA_NOTA_FISCAL]
	,PEDIDO.[NOTA_EMITIDA]
	,PEDIDO.[CARTAO_ANEXO]
	,PEDIDO.[VALOR_DESCONTO]
	,PEDIDO.[OBSERVACOES]
	,PEDIDO.[VALOR_FRETE]
	,PEDIDO.[VALOR_FRETE_ADICIONAL]
	,PEDIDO.[FRETE_CALCULADO_CUPOM]
	,PEDIDO.[NUMERO_CUPOM_FISCAL]
	,PEDIDO.[CHAVE_NFE]
	,PEDIDO.[TOTAL]
	,PEDIDO.[STATUS] AS IDSTATUS_PED
	,STATUS_PEDIDO.DESCRICAO AS DESCRICAO_STATUS_PEDIDO
	,CONVERT(DATE,PEDIDO.[DATA_CRIACAO]) AS [DATA_CRIACAO]
	,PEDIDO.[VALOR_DESCONTO_PERSONALIZADO]
FROM 
	[dbCestaNatal].[dbo].[SMCB_PEDIDO] as PEDIDO WITH(NOLOCK)
		INNER JOIN [dbCestaNatal].[dbo].[SMCB_FORMA_PAGAMENTO] AS FORMA_PAGAMENTO  WITH(NOLOCK) ON (PEDIDO.IDFORMA_PAGAMENTO = FORMA_PAGAMENTO.IDFORMA_PAGAMENTO)
		INNER JOIN [dbCestaNatal].[dbo].[SMCB_USUARIO] AS USUARIO  WITH(NOLOCK) ON (PEDIDO.IDUSUARIO = USUARIO.IDUSUARIO)
		INNER JOIN [dbCestaNatal].[dbo].[SMCB_CLIENTE] AS CLIENTE  WITH(NOLOCK) ON (PEDIDO.IDCLIENTE = CLIENTE.IDCLIENTE)
			LEFT JOIN [dbCestaNatal].[dbo].[SMCB_PESSOA] AS PESSOA  WITH(NOLOCK) ON (CLIENTE.IDPESSOA = PESSOA.IDPESSOA)
		INNER JOIN [dbCestaNatal].[dbo].[SMCB_STATUS] AS STATUS_PEDIDO  WITH(NOLOCK) ON (PEDIDO.[STATUS] = STATUS_PEDIDO.IDSTATUS)
			LEFT JOIN [dbCestaNatal].[dbo].[SMCB_MOTIVO_FINANCEIRO] AS MOTIVO_FINANCEIRO  WITH(NOLOCK) ON (PEDIDO.IDMOTIVO_FINANCEIRO = MOTIVO_FINANCEIRO.IDMOTIVO_FINANCEIRO)
WHERE 1=1
	AND CONVERT(DATE,PEDIDO.DATA_CRIACAO) > CONVERT(DATE,GETDATE()-180)
	and PEDIDO.STATUS <> 2
	
UNION ALL


SELECT 
	9999999
	,'PDV' AS DESCRICAO_FORMA_PAGAMENTO
	,'PDV' AS NOME_USUARIO
	,NULL AS CNPJCPF
	,'PDV' AS NOME_PESSOA
	,NULL AS EMAIL
	,NULL AS DESCRICAO_MOTIVO_FINANCEIRO
	,NULL AS NUMERO_NOTA_FISCAL
	,NULL AS DATA_NOTA_FISCAL
	,NULL AS NOTA_EMITIDA
	,NULL AS CARTAO_ANEXO
	,0 AS VALOR_DESCONTO
	,'VENDA PDV' AS OBSERVACOES
	,0 AS VALOR_FRETE
	,0 AS VALOR_FRETE_ADICIONAL
	,0 as FRETE_CALCULADO_CUPOM --verificar
	,1 AS NUMERO_CUPOM_FISCAL
	,NULL AS CHAVE_NFE
	
	
	,(
		SELECT
			SUM(M03AP) AS VALOR_VENDA
		FROM
			ZEUSRETAIL.DBO.ZAN_M03 AS PDV with (nolock) INNER JOIN AX2009_INTEGRACAO.DBO.TAB_CODIGO_BARRA AS CB with (nolock) ON (PDV.M03AH = CB.COD_EAN)
		WHERE 1 = 1
			AND CONVERT(DATE,PDV.M00AF) >= CONVERT(DATE,GETDATE()-180)
			AND PDV.M00ZA = 7
			--AND CAST(M03AH AS DOUBLE PRECISION) 
			AND cast(CB.COD_PRODUTO as double precision) IN (394697,394703,394710,394727,543101,543118,543125,543200,543224,543248,543279,543309,543330,543361,543378,543392,543415,543439,1001449,1001450,1001451)
			AND PDV.M00AD NOT IN (SELECT DISTINCT [NUMERO_CUPOM_FISCAL] FROM [dbCestaNatal].[dbo].[SMCB_PEDIDO])
	) AS TOTAL
	
	,12 AS IDSTATUS_PED	
	,'Entregue' AS DESCRICAO_STATUS_PEDIDO
	,GETDATE() AS DATA_CRIACAO
	,NULL AS VALOR_DESCONTO_PERSONALIZADO;





