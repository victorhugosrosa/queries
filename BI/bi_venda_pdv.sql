declare @DT_INICIO as date = '20140714'
declare @DT_TErmino as date = '20140717'

SELECT
	C.DATA
	,C.HORA
	,C.COD_LOJA
	,C.CAIXA
	,C.CUPOM
	,C.OPERADOR
	,T.COD_PRODUTO
	,MAX(T.QTDE) AS QTDE
	,MAX(T.VALOR) AS VALOR
	,(CASE
		WHEN HORA >= 0 AND HORA < 100 THEN '0'
		WHEN HORA >= 100 AND HORA < 200 THEN '1'
		WHEN HORA >= 200 AND HORA < 300 THEN '2'
		WHEN HORA >= 300 AND HORA < 400 THEN '3'
		WHEN HORA >= 400 AND HORA < 500 THEN '4'
		WHEN HORA >= 500 AND HORA < 600 THEN '5'
		WHEN HORA >= 600 AND HORA < 700 THEN '6'
		WHEN HORA >= 700 AND HORA < 800 THEN '7'
		WHEN HORA >= 800 AND HORA < 900 THEN '8'
		WHEN HORA >= 900 AND HORA < 1000 THEN '9'
		WHEN HORA >= 1000 AND HORA < 1100 THEN '10'
		WHEN HORA >= 1100 AND HORA < 1200 THEN '11'
		WHEN HORA >= 1200 AND HORA < 1300 THEN '12'
		WHEN HORA >= 1300 AND HORA < 1400 THEN '13'
		WHEN HORA >= 1400 AND HORA < 1500 THEN '14'
		WHEN HORA >= 1500 AND HORA < 1600 THEN '15'
		WHEN HORA >= 1600 AND HORA < 1700 THEN '16'
		WHEN HORA >= 1700 AND HORA < 1800 THEN '17'
		WHEN HORA >= 1800 AND HORA < 1900 THEN '18'
		WHEN HORA >= 1900 AND HORA < 2000 THEN '19'
		WHEN HORA >= 2000 AND HORA < 2100 THEN '20'
		WHEN HORA >= 2100 AND HORA < 2200 THEN '21'
		WHEN HORA >= 2200 AND HORA < 2300 THEN '22'
		WHEN HORA >= 2300 AND HORA < 2400 THEN '23'
		WHEN HORA >= 2400 THEN '24'
	END) AS HORA_INT
FROM
	[DW].[DBO].[BI_ANAL_MOVTO_CAIXA] AS C
	INNER JOIN [DW].[DBO].[BI_ANAL_TICKET] AS T
		ON 1 = 1
		AND C.COD_LOJA = T.COD_LOJA
		AND C.CAIXA = T.CAIXA
		AND C.CUPOM = T.CUPOM
WHERE 1 = 1
	AND CONVERT(DATE,C.DATA) BETWEEN CONVERT(DATE,@DT_INICIO) AND CONVERT(DATE,@DT_TErmino)
	--and C.COD_LOJA = 7
	--and C.CAIXA = 23
	--and C.CUPOM = 19612
GROUP BY
	C.DATA
	,C.HORA
	,C.COD_LOJA
	,C.CAIXA
	,C.CUPOM
	,C.OPERADOR
	,T.COD_PRODUTO
	
/*



SELECT TOP 10
*
FROM
	[DW].[DBO].[BI_ANAL_TICKET]




DELETE FROM BI.DBO.BI_VENDA_PDV
WHERE 1 = 1
	AND CONVERT(DATE,DATA) BETWEEN CONVERT(DATE,@DT_INICIO) AND CONVERT(DATE,@DT_TErmino)
	
INSERT INTO BI.DBO.BI_VENDA_PDV
(
	[DATA]
	,[HORA]
	,[COD_LOJA]
	,[CAIXA]
	,[CUPOM]
	,[FINALIZADORA]
	,[REDE]
	,[BANDEIRA]
	,[OPERADOR]
	,[VALOR_LIQUIDO]
	,[VALOR_DESCONTO]
)
SELECT
	DATA
	,HORA
	,COD_LOJA
	,CAIXA
	,CUPOM
	,FINALIZADORA
	,REDE
	,BANDEIRA	
	,OPERADOR
	,VALOR_LIQUIDO
	,VALOR_DESCONTO
FROM
	[DW].[DBO].[BI_ANAL_MOVTO_CAIXA]
WHERE 1 = 1
	AND CONVERT(DATE,DATA) BETWEEN CONVERT(DATE,@DT_INICIO) AND CONVERT(DATE,@DT_TErmino)

update BI.DBO.BI_VENDA_PDV
set
	HORA_INT = (CASE
					WHEN HORA >= 0 AND HORA < 100 THEN '0'
					WHEN HORA >= 100 AND HORA < 200 THEN '1'
					WHEN HORA >= 200 AND HORA < 300 THEN '2'
					WHEN HORA >= 300 AND HORA < 400 THEN '3'
					WHEN HORA >= 400 AND HORA < 500 THEN '4'
					WHEN HORA >= 500 AND HORA < 600 THEN '5'
					WHEN HORA >= 600 AND HORA < 700 THEN '6'
					WHEN HORA >= 700 AND HORA < 800 THEN '7'
					WHEN HORA >= 800 AND HORA < 900 THEN '8'
					WHEN HORA >= 900 AND HORA < 1000 THEN '9'
					WHEN HORA >= 1000 AND HORA < 1100 THEN '10'
					WHEN HORA >= 1100 AND HORA < 1200 THEN '11'
					WHEN HORA >= 1200 AND HORA < 1300 THEN '12'
					WHEN HORA >= 1300 AND HORA < 1400 THEN '13'
					WHEN HORA >= 1400 AND HORA < 1500 THEN '14'
					WHEN HORA >= 1500 AND HORA < 1600 THEN '15'
					WHEN HORA >= 1600 AND HORA < 1700 THEN '16'
					WHEN HORA >= 1700 AND HORA < 1800 THEN '17'
					WHEN HORA >= 1800 AND HORA < 1900 THEN '18'
					WHEN HORA >= 1900 AND HORA < 2000 THEN '19'
					WHEN HORA >= 2000 AND HORA < 2100 THEN '20'
					WHEN HORA >= 2100 AND HORA < 2200 THEN '21'
					WHEN HORA >= 2200 AND HORA < 2300 THEN '22'
					WHEN HORA >= 2300 AND HORA < 2400 THEN '23'
					WHEN HORA >= 2400 THEN '24'
				END)
WHERE 1 = 1
	AND HORA_INT IS NULL
	
*/