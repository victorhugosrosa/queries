/* Finished
EXEC BI.[dbo].[CARGA_BI_VENDA_CUPOM_CAPA] '2015-01-01','2015-01-31'
EXEC BI.[dbo].[CARGA_BI_VENDA_CUPOM_CAPA] '2015-02-01','2015-02-28'
EXEC BI.[dbo].[CARGA_BI_VENDA_CUPOM_CAPA] '2015-03-01','2015-03-31'
EXEC BI.[dbo].[CARGA_BI_VENDA_CUPOM_CAPA] '2015-04-01','2015-04-30'
EXEC BI.[dbo].[CARGA_BI_VENDA_CUPOM_CAPA] '2015-05-01','2015-05-31'
EXEC BI.[dbo].[CARGA_BI_VENDA_CUPOM_CAPA] '2015-06-01','2015-06-30'
EXEC BI.[dbo].[CARGA_BI_VENDA_CUPOM_CAPA] '2015-07-01','2015-07-31'
EXEC BI.[dbo].[CARGA_BI_VENDA_CUPOM_CAPA] '2015-08-01','2015-08-31'
EXEC BI.[dbo].[CARGA_BI_VENDA_CUPOM_CAPA] '2015-09-01','2015-09-30'
EXEC BI.[dbo].[CARGA_BI_VENDA_CUPOM_CAPA] '2015-10-01','2015-10-31'
EXEC BI.[dbo].[CARGA_BI_VENDA_CUPOM_CAPA] '2015-11-01','2015-11-30'
EXEC BI.[dbo].[CARGA_BI_VENDA_CUPOM_CAPA] '2015-12-01','2015-12-31'
*/

DECLARE @DATA_INI AS DATE = '2015-07-01'
DECLARE @DATA_FIM AS DATE = '2015-12-31'

UPDATE VCC
SET
	VCC.CPF_NFP = CC.NOTA_FISCAL_PAULISTA
	,VCC.CPF_VCM = CC.VOCE_MARCHE
	,VCC.CPF_CONTA_CLIENTE = CC.CONTA_CLIENTE
FROM 
	[BI].[dbo].BI_VENDA_CUPOM_CAPA AS VCC
	INNER JOIN DW.dbo.CUPOM_CLIENTES AS CC
		ON 1=1
		AND VCC.COD_LOJA = CC.COD_LOJA
		AND VCC.CUPOM = CC.CUPOM
		AND VCC.CAIXA = CC.PDV
		AND CONVERT(DATE,VCC.DATA) = CONVERT(DATE,CC.DATA)
WHERE 1=1
	AND CONVERT(DATE,VCC.DATA) BETWEEN CONVERT(DATE,@DATA_INI) AND CONVERT(DATE,@DATA_FIM)