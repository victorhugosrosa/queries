DECLARE @TAB_NEW_454 AS TABLE
(
	ANO_454 INT
	,SEMANA_454 INT
	,ANO_454_NEW INT
	,SEMANA_454_NEW INT
	,PRIMARY KEY (ANO_454,SEMANA_454)
)

-- -----------------------------------------------------------------------------
-- Semana 53 = 1 and ANO_454 = ANO_454+1
-- -----------------------------------------------------------------------------
INSERT INTO @TAB_NEW_454
	SELECT DISTINCT
		ANO_454
		,SEMANA_454
		,(CASE WHEN SEMANA_454 = 53 THEN ANO_454+1 ELSE ANO_454 END) AS ANO_454_NEW
		,(CASE WHEN SEMANA_454 = 53 THEN 1 ELSE SEMANA_454 END) AS SEMANA_454_NEW
	FROM
		BI.DBO.BI_CAD_SEMANA
	WHERE 1=1
		AND ANO_454 IN
		(
		SELECT DISTINCT
			ANO_454
		FROM
			BI.DBO.BI_CAD_SEMANA
		WHERE 1=1
			AND SEMANA_454 = 53
		)

-- -----------------------------------------------------------------------------
-- SEMANA_454 = SEMANA_454 + 1 (SEMANA_454 <> 52)
-- -----------------------------------------------------------------------------	
INSERT INTO @TAB_NEW_454
	SELECT DISTINCT
		ANO_454
		,SEMANA_454
		,ANO_454 AS ANO_454_NEW
		,SEMANA_454+1 AS SEMANA_454_NEW
	FROM
		BI.DBO.BI_CAD_SEMANA
	WHERE 1=1
		AND SEMANA_454 <> 52
		AND ANO_454 IN
		(
		SELECT DISTINCT
			ANO_454
		FROM
			BI.DBO.BI_CAD_SEMANA
		WHERE 1=1
			AND ANO_454 NOT IN
			(
			SELECT DISTINCT
				ANO_454
			FROM
				BI.DBO.BI_CAD_SEMANA
			WHERE 1=1
				AND SEMANA_454 = 53
			)
		)
	
-- -----------------------------------------------------------------------------
-- Semana 52 = 1 and ANO_454 = ANO_454+1 (SEMANA_454 = 52)
-- -----------------------------------------------------------------------------	
INSERT INTO @TAB_NEW_454
	SELECT DISTINCT
		ANO_454
		,SEMANA_454
		,ANO_454+1 AS ANO_454_NEW
		,1 AS SEMANA_454_NEW
	FROM
		BI.DBO.BI_CAD_SEMANA
	WHERE 1=1
		AND SEMANA_454 = 52
		AND ANO_454 IN
		(
		SELECT DISTINCT
			ANO_454
		FROM
			BI.DBO.BI_CAD_SEMANA
		WHERE 1=1
			AND ANO_454 NOT IN
			(
			SELECT DISTINCT
				ANO_454
			FROM
				BI.DBO.BI_CAD_SEMANA
			WHERE 1=1
				AND SEMANA_454 = 53
			)
		)

-- -----------------------------------------------------------------------------
-- UPDATE
-- -----------------------------------------------------------------------------
	/*
	UPDATE BI.DBO.BI_CAD_SEMANA SET ANO_454_NEW = NULL, MES_454_NEW = NULL, SEMANA_454_NEW = NULL
	
	UPDATE CS
	SET
		CS.ANO_454_NEW = T.ANO_454_NEW
		,CS.SEMANA_454_NEW = T.SEMANA_454_NEW
	FROM
		BI.DBO.BI_CAD_SEMANA AS CS
		INNER JOIN @TAB_NEW_454	AS T
			ON 1=1
			AND CS.SEMANA_454 = T.SEMANA_454
			AND CS.ANO_454 = T.ANO_454
			
	UPDATE BI.DBO.BI_CAD_SEMANA SET MES_454_NEW = 1 WHERE SEMANA_454_NEW IN (1,2,3,4)
	UPDATE BI.DBO.BI_CAD_SEMANA SET MES_454_NEW = 2 WHERE SEMANA_454_NEW IN (5,6,7,8,9)
	UPDATE BI.DBO.BI_CAD_SEMANA SET MES_454_NEW = 3 WHERE SEMANA_454_NEW IN (10,11,12,13)
	UPDATE BI.DBO.BI_CAD_SEMANA SET MES_454_NEW = 4 WHERE SEMANA_454_NEW IN (14,15,16,17)
	UPDATE BI.DBO.BI_CAD_SEMANA SET MES_454_NEW = 5 WHERE SEMANA_454_NEW IN (18,19,20,21,22)
	UPDATE BI.DBO.BI_CAD_SEMANA SET MES_454_NEW = 6 WHERE SEMANA_454_NEW IN (23,24,25,26)
	UPDATE BI.DBO.BI_CAD_SEMANA SET MES_454_NEW = 7 WHERE SEMANA_454_NEW IN (27,28,29,30)
	UPDATE BI.DBO.BI_CAD_SEMANA SET MES_454_NEW = 8 WHERE SEMANA_454_NEW IN (31,32,33,34,35)
	UPDATE BI.DBO.BI_CAD_SEMANA SET MES_454_NEW = 9 WHERE SEMANA_454_NEW IN (36,37,38,39)
	UPDATE BI.DBO.BI_CAD_SEMANA SET MES_454_NEW = 10 WHERE SEMANA_454_NEW IN (40,41,42,43)
	UPDATE BI.DBO.BI_CAD_SEMANA SET MES_454_NEW = 11 WHERE SEMANA_454_NEW IN (44,45,46,47,48)
	UPDATE BI.DBO.BI_CAD_SEMANA SET MES_454_NEW = 12 WHERE SEMANA_454_NEW IN (49,50,51,52)
	*/
	
	