DECLARE @TAB_MODEL_ARMAZENAGEM AS TABLE
(
	FORNECEDOR_COMPRAS INT
	,COD_PRODUTO INT
	,ModelArmazenagem VARCHAR(30)
	,PRIMARY KEY (FORNECEDOR_COMPRAS, COD_PRODUTO)
)

INSERT INTO @TAB_MODEL_ARMAZENAGEM
	SELECT
		FORNECEDOR_COMPRAS
		,COD_PRODUTO
		,(CASE
			WHEN afp.ModelArmazenagem = 0 THEN 'Direto'
			WHEN afp.ModelArmazenagem = 1 THEN 'CrossDocking'
			WHEN afp.ModelArmazenagem = 2 THEN 'Armazenagem'
			WHEN afp.ModelArmazenagem = 3 THEN 'PickingUnitario'
		END) AS TIPO_ABASTECIMENTO
	FROM AX2009_INTEGRACAO.DBO.TAB_PRODUTO_FORNECEDOR_PREFERENCIAL AS AFP
	WHERE 1=1
		AND AFP.COD_LOJA = 5
		AND AFP.FORNECEDOR_COMPRAS IN (4,6,19,75,109,115,118,193,211,241,244,269,281,302,332,405,434,444,458,499,542,584,623,643,683,717,905,1000,1022,1083,1332,1495,1522,1583,1635,1789,1807,1817,1879,1887,1889,1950,2015,2058,2078,2084,2183,2206,2210,2214,2250,2256,2265,2273,2346,2420,2476,2524,2554,10990,13696,13754,13767,13777,13831,13893,13912,13977,14007,14103,14131,14171,14204,14226,14310,14325,14341,14430,14450,14508,14552,14593,14680,14682,14816,14837,15125,15182,15274,15334,15351,15512,15585,15663,15860,15930,15931,15937,15962,15972,16102,16146,16151,16170,16194,16219,16224,16236,16260,16274,16362,16481,16482,16487,16517,16537,16539,16579,16586,16601,16658,16753,16845,16858,16882,16904,16945,16946,17018,17034,17035,17072,17219,17383,17502,17515,17520,17543,17575,17627,17748,17761,17763,17797,17850,17861,17897,17898,17938,17945,17992,18115,18116,18193,18231,18325,18344,18359,18362,18374,18377,18382,18437,18438,18469,18491,18529,18584,60093,60285,62379,70019,100060,100091,100093,100143,100244,100292,100296,100425,100610,101509,101566,101590,101613,101630,101635,101636,101649,101689,101714,101765,101816,101859,101869,101870,101882,101892,101949,101979,101986,101987,102009,102025,102119,102150,102166,102169,102219,102235,102294,102315,102316,102365,102394,102572,102606,102667,102684,102706,102730,102732,102733,102751,102773,102778,102807,102811,102828,102832,102902,102918,102951,102962,102964,102973,102985,103014,103050,103053,103059,103095,103104,103142,103143,103145,103165,103209,103211,103226,103241,103265,103290,103337,103348,103395,103419,103432,103454,103460,103462,103517,103518,103572,103612,103647,103676,103696,103697,103704,103710,103711,103715,103717,103719,103720,103721,103724,103731,103758,103764,103765,103768,103787,103797,103805,103808,103820,103824,103863,103922,104004,104011,104012,104039,104073,104089,104090,104093,104095,104096,104098,104099,104101,104106,104109,104111,104147,104170,104205,104207,104230,104231,104258,104261,104267,104351,104381,2150,104356,104347,104409,104489,102639,104550,104451,104486,103425,104541,104514,104534,104568,18154,104454,104525,104634,104355,850,104664,104734,104635,104605,104441,104663,104498,103471,104706,104811,104825,104603,104640,104383,104408,104776,104580,104272,104379,102883,103800,104612,104407,104656,205,103864,104601,104684,14717,104678,104828,104312,102966,104342,104604,104679,104736,104662,104661,104890,104846,17081,101595,104805,104729,2419,103266,104623,18126,103579,104245,104382,103737,104677,103728,104670,104682,104346,16675,101990,104242,104273,104377,1008,104482,104181,100454,16188,14185,104264,13970)

 SELECT
	LP.COD_LOJA
	,PF.COD_PRODUTO
	,CP.DESCRICAO
	,ABC.ABC_LOJA AS ABC_SUPPLY
	,LP.CLASSIF_PRODUTO_LOJA AS ABC_LOJA
	,CP.COD_DEPARTAMENTO
	,CP.NO_DEPARTAMENTO
	,CP.COD_SECAO
	,CP.NO_SECAO
	,LP.FORA_LINHA
	,BI.dbo.fn_FormataVlr_Excel(FAT_SZ) as FAT_SZ
	,BI.dbo.fn_FormataVlr_Excel(DIA_SS) as DIA_SS
	,BI.dbo.fn_FormataVlr_Excel(QTD_EXP) as QTD_EXP
	,BI.dbo.fn_FormataVlr_Excel(QTD_DIAS_MAX_COMPRA) as QTD_DIAS_MAX_COMPRA
	,PF.FORNECEDOR_COMPRAS
	,CF.DESCRICAO AS NO_FORNECEDOR
	,BI.dbo.fn_FormataVlr_Excel(PR.MARCHEQTDEMBALAGEM) as MARCHEQTDEMBALAGEM
	,BI.dbo.fn_FormataVlr_Excel(PR.MARCHEMULTIPLO) as MARCHEMULTIPLO
	,BI.dbo.fn_FormataVlr_Excel(PR.MARCHEUNITID) as MARCHEUNITID
	,PF.ModelArmazenagem AS TIPO_ABASTECIMENTO
	--,BI.dbo.fn_FormataVlr_Excel(C.VLR_EMB_COMPRA) as VLR_EMB_COMPRA
	--,BI.dbo.fn_FormataVlr_Excel(C.QTD_EMB_COMPRA) as QTD_EMB_COMPRA	
FROM
	@TAB_MODEL_ARMAZENAGEM as PF
	INNER JOIN BI.DBO.BI_CAD_PRODUTO AS CP
		ON PF.COD_PRODUTO = CP.COD_PRODUTO
	INNER JOIN BI.dbo.BI_CAD_FORNECEDOR AS CF
		ON 1=1
		AND PF.FORNECEDOR_COMPRAS = cF.COD_FORNECEDOR
	INNER JOIN [BI].[dbo].BI_LINHA_PRODUTOS AS LP
		ON 1=1
		AND PF.COD_PRODUTO = LP.COD_PRODUTO		
	LEFT JOIN [BI].[dbo].[COMPRA_PRODUTO_PARAMETRO] AS PP
		ON 1=1
		AND PF.COD_PRODUTO = PP.COD_PRODUTO
		AND LP.COD_LOJA = PP.COD_LOJA
	LEFT JOIN [BI].[dbo].SUPPLY_PRODUTO_ABC_LOJA AS ABC
		ON 1=1
		AND PF.COD_PRODUTO = ABC.COD_PRODUTO
		AND LP.COD_LOJA = ABC.COD_LOJA
	LEFT JOIN AX2009_INTEGRACAO.DBO.TAB_PRODUTO_REFERENCIA AS PR
		ON 1=1
		AND PF.COD_PRODUTO = PR.COD_PRODUTO
		AND PF.FORNECEDOR_COMPRAS = PR.COD_FORNECEDOR
	--left join BI.dbo.VW_CUSTOS_ATIVOS as c
	--	ON 1=1
	--	AND PF.COD_PRODUTO = c.COD_PRODUTO
	--	AND PF.FORNECEDOR_COMPRAS = c.COD_FORNECEDOR
WHERE 1=1
	and LP.FORA_LINHA = 'N'