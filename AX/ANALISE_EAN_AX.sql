DECLARE @TAB_SEM_EAN_PC AS TABLE
(
	COD_PRODUTO INT
	,ITEMNAME VARCHAR(1000)
	,PROIBIDO_COMPRA VARCHAR(1)
)

INSERT INTO @TAB_SEM_EAN_PC
SELECT
	COD_PRODUTO
	,ITEMNAME
	,(CASE WHEN QTD_LOJAS = 16 AND PROIBIDO_COMPRA = 'S' THEN 'S' ELSE 'N' END) AS PROIBIDO_COMPRA
FROM
(
	select
		PS.COD_PRODUTO
		,PROD.ITEMNAME
		,PS.PROIBIDO_COMPRA
		,COUNT(PS.COD_PRODUTO) AS QTD_LOJAS
	from
		AX2009_INTEGRACAO.dbo.vw_MARCHE_PRODUTO_SITUACAO AS PS LEFT JOIN SMA_AX50_SP1_DB_PROD.dbo.INVENTTABLE AS PROD ON (PS.ITEMID = PROD.itemid)
	where 1 = 1
		--and PROIBIDO_COMPRA = 'S'
		--and COD_PRODUTO = 1012267
		AND PS.COD_LOJA IN (1,2,3,4,6,7,9,10,12,13,17,18,19,20,21,30)
		and PROD.DATAAREAID = 'VCM'
		and PS.COD_PRODUTO in
		(01009713,00993618,00999687,00380850,01010386,00995817,00995820,00995778,00012635,00646673,00998947,00997918,00995731,01011080,00995852,00995858,01012629,00991618,00995894,01000568,01001152,00018807,00998277,01009723,00999891,00019521,01010388,00995943,01009980,01002817,00996023,00996036,00299732,00991569,01009697,00996065,00996076,00996077,00996087,01010483,00996101,01011118,01011390,01011403,00996114,00996121,00996122,00998365,01009701,01013175,00020091,01009661,00999983,00992667,01009671,01012311,00998148,00998984,01010359,00995838,00995843,00017176,01011111,00995854,00998237,00992031,01005465,01007846,01010373,01010376,01010351,00995887,01002088,00995890,00669771,01008117,01008585,00995906,00995909,01013100,01013190,01009725,01012267,01006092,00995942,01008105,01002138,00996033,00996044,00996058,00999917,00996064,00996070,01006026,00999529,01008575,01010464,01011400,00995799,00019392,01007211,01000985,01001000,01009699,00524933,00995807,01009645,01009649,00995809,00995810,00995813,01009659,00995824,01008285,00990775,01001442,00998464,00998463,01011106,00995831,00991581,00995840,00995841,00995849,00998283,01000913,00995856,00019569,01011115,00995864,01012633,00995881,01010398,01000999,01011119,01007727,01001223,00995915,01009707,00995925,01013083,00018395,00998470,00995958,01008116,01002162,01001531,00996005,00996006,00996045,01001564,01001562,00998126,00998127,00998955,00996097,01010392,01011386,00996110,00996117,00539883,00995805,01012664,01004154,00998815,00555784,01008569,00995827,00290104,00992671,00992663,01008344,01008589,00995835,00708500,01010478,01006775,01006779,01001567,00541039,00995859,01001544,01011079,00995865,00995875,00995876,00995882,01012580,00545181,00991074,01007548,00369138,00995920,00992037,00995927,00998936,00998469,00019446,00990862,01004925,01002523,01001144,00995957,00995969,00995984,01009550,00995991,00999446,01007848,01007869,00999450,00996052,00996071,00996093,00996098,01010467,01010458,00999913,00996116,00019101,00999914,00995801,01001530,01001558,00998272,00020084,00999982,01000616,00992661,00992665,00990791,00999886,01009669,01008577,01011380,00992610,01001823,00999960,01008393,01011100,01011370,01011133,00997921,00998079,00995837,01009986,01001505,00995847,00995850,00541046,00995861,00998235,00995863,00995873,01005464,01008172,00998875,01008587,00995904,00998906,00999916,01013091,01013102,01001151,01013104,01013188,00018531,00999662,00995932,00998956,00998284,00995945,00995950,00995959,01002496,00995961,00995965,00995974,01007512,00995994,01001229,00996004,01001504,00996035,00996043,00996062,00996063,01000912,01001561,01010355,01005468,00994622,00999042,01000995,00996080,00996081,00996084,00996102,00991712,01011374,00999911,00996106,01009711,00995800,01004924,00999884,01013173,01010382,01006072,00995811,00992608,00991262,01009673,01010384,00995830,01011081,01011082,00995833,01001546,00995834,01006777,01002618,00995842,01005467,00995853,00995862,00991560,01010394,00995891,01009538,00995897,01008525,01010027,00998816,00995914,00995921,01009705,524667,01013096,01010008,00018432,01001555,00995939,01004926,01009691,00995947,00995956,01002400,01007248,00996021,00996030,00996037,00996042,00996048,00996060,01001565,00996066,00996078,01008877,00996085,01010496,00996091,01006088,01011393,00996104,00996118,00991608,00556682,00998252,01013177,00995816,00991739,00995829,00998257,01001559,00997920,00997925,00998979,01001552,00998802,00995839,01011107,01011088,01001910,01001542,01001548,01011083,01002979,01002978,00995892,01008174,01007855,01008114,01004156,00998874,01004011,00995907,01004171,01010591,01013079,01013098,01011116,00089399,00995937,00995938,00999892,01010390,00995949,00995983,00996003,01003756,01007567,00996009,00996010,01002397,00996020,00996040,00996069,01010402,00998285,00107341,00996095,00996099,00996100,00999263,00999895,00999912,01009715,00998814,01008571,01009651,00992613,00992616,00992651,01008439,00998258,00997922,01001146,01008342,01011110,00717458,00998238,00995877,00993976,01010400,00991537,00995888,00995889,01011131,01001537,01009542,01005091,01001148,00995919,00992060,01009729,01013095,01008345,00995935,01002578,00995948,00995951,00995955,00995993,00999447,00999448,00998408,00996016,00996017,00996018,00991578,01001550,00998953,00996075,00999528,00999530,01001539,01011108,00996086,00996092,01010456,01010391,01011384,00429610,00995775,00995777,00996119,00998363,01001557,01013174,00998291,00995814,00999194,00999980,00998795,00992649,00992874,01009675,01002561,01009677,00997927,00998921,00995867,00995880,01010404,00995884,01010508,01006076,01007240,00995900,00995902,01004329,00998905,00995911,00995918,524520,01013094,01013192,00018487,01007376,00998274,00995936,00995962,00995990,00996008,00996012,00996013,00996014,00996022,00996025,00996032,00996056,00998985,00996083,00998939,00000001,00995053,00998679,01002016,01011382,00991166,00395670,00996113,01011103,00995806,00019538,01013176,00573290,01000604,00995823,01009717,00994068,01010370,00992670,00576468,01002591,00405652,00998983,00999023,01001536,01011122,00995851,01011086,00995855,01011124,01010363,01011094,01006078,00995893,01009984,01004170,00999915,00995905,00995910,00995912,01013093,00995929,00998264,00999677,01009733,00019453,00990860,01011114,00995940,00995953,00995960,01005089,00995975,00995988,01001502,00995989,00995997,01001911,00996039,00996051,00998206,01001566,00562805,00429580,01001545,01011372,01012068,00999898,01001543,01004735,01006084,00209373,00995822,01009657,00994674,01000547,01008592,00995828,00998279,00997926,00998281,00999888,01011112,00997895,00995857,00995860,00993972,00995868,00995872,01010353,00998230,01007878,01007858,00998352,01002645,00995908,01008579,01008581,01009703,01013099,01013189,01013092,01013191,00999889,00995931,01009679,00999678,00019507,00019552,01008559,00995971,01008175,00995982,01009546,01001706,01008118,01002020,00996049,00996061,00993971,01010357,00998862,00996088,00996090,01009727,01009965,01010470,00998865,01011396,00999264,00996120,00990802,00357159,01001556,00998364,00995803,01006082,01006080,00995808,00991011,01013178,00998296,01006068,00995818,00995821,01008567,01009655,01000055,00995836,00998282,01006778,01007651,01002981,01010126,01010396,00479875,00999452,01008173,00998353,01005612,01006746,01010494,00995916,00524520,01013097,01013101,01009731,00998344,00995928,00018524,00018555,00990774,01009721,00999975,01001554,01001350,00995964,00995968,00995979,01002168,00995987,00995996,00996015,00996031,01006316,00996041,00996050,00996055,00996057,00990978,01000912,00996068,00992619,00999043,01001971,00990785,01010020,00999897,00999243,01011388,00996115,00019071,00990858,00995804,00998866,00998297,01007225,00999986,00991943,01009653,00999981,00999984,01010367,00995825,00992660,00992646,01009719,00994069,01000329,00998471,01011098,00999887,01011096,00997924,00998067,01011368,01011092,01011125,00991602,00995866,00995879,00479868,00999432,00995896,00995899,00998898,00995901,01013103,00348508,01010379,00993866,00998351,00998468,01008561,01012306,00995944,00995973,00995992,00996000,00996001,00996011,00996027,00996028,01008115,00996047,01011376,01009695,01007028,00998861,00990771,00999919,00996105,00996108,01001541,00998362,00995740,00293716,01001538,00998867,01013179,00998298,01006070,01006074,00995812,00569019,00020077,00991454,00991458,00992611,01009665,01000570,01003513,00997923,00999019,01008119,01008176,00995844,00991544,00993973,01011132,00995869,00995870,00995886,01006025,01001568,01009982,00998877,01007726,01008388,00995922,00995923,00542050,01009709,01008693,00995933,01009739,01000557,01001533,00024396,00995972,00995980,00995981,01002028,01000455,01001918,00996038,01011378,00415293,00996073,00998954,00996074,00999531,00990770,00999457,00999931,00998269,00991723,01010460,01010462,00998479,00991001,01001547,01004155,00590914,01008565,00990979,00998300,00995815,00995819,01007341,01011117,01000612,00992620,00992668,01000007,00999957,01009663,01008563,01008595,01011090,01011120,01011109,01011121,00995832,01000133,00998982,01006774,01008343,00995846,01005466,00995871,00995878,00995883,01006747,01002982,00995885,01007873,00998873,00995903,00992902,00998286,00995913,00995917,01013105,00995926,00025959,01001540,01001553,00995934,01001695,00990793,00998937,00995952,00995954,00999384,01008993,01001232,00995978,00997294,00997298,00995999,00996002,00996053,01009737,01009735,00999532,01002980,00996079,00996082,00998270,00996094,01010487,00999910,01011392,01006086,00998868,01009647,00998299,00999985,00998894,01001549,01012133,01009667,01001560,00997919,00999024,01006776,00995845,01011113,00010195,00998371,00995874,00998474,01011101,01008341,00999626,00995895,00537391,01008583,01006871,01002666,00995924,01013187,00999503,00018814,00018562,00018579,00089197,01000556,00999890,01001535,01010590,01002577,00019514,00995941,01005559,01006090,01009693,00995946,00995963,01002514,01001708,01001356,00995977,00997295,01002800,00995998,00996007,00997299,00996026,00996029,00996034,01008104,00996046,00996054,00996059,00704717,00996072,01010361,00998974,00999893,01003467,01011123,00999894,01008574,00996096,01010474,00996103,00999896,00996107,00992759,00991094,00036016,00996112)
	GROUP BY
		PS.COD_PRODUTO
		,PROD.ITEMNAME
		,PS.PROIBIDO_COMPRA
) AS X
WHERE 1 = 1
	--AND PROIBIDO_COMPRA = 'S'
	--AND QTD_LOJAS = 16

-- --------------------------------------------------------------------------------------------------------------------
-- FORA DE LINHA E COM REPETIÇÃO NO AX [DELETAR]
-- --------------------------------------------------------------------------------------------------------------------
	SELECT DISTINCT
		TEMP.COD_PRODUTO
		,TEMP.ITEMNAME
		,TEMP.PROIBIDO_COMPRA
		--,PROD.ITEMID
		--,PROD.ITEMNAME
		,'FORA DE LINHA E COM REPETIÇÃO NO AX [DELETAR]'
	FROM
		@TAB_SEM_EAN_PC AS TEMP LEFT JOIN SMA_AX50_SP1_DB_PROD.dbo.INVENTTABLE AS PROD ON (TEMP.ITEMNAME = PROD.ITEMNAME AND TEMP.COD_PRODUTO <> PROD.ITEMID)
	WHERE 1 = 1
		AND TEMP.PROIBIDO_COMPRA = 'S'
		and PROD.DATAAREAID = 'VCM'
		AND PROD.ITEMID NOT IN (SELECT DISTINCT COD_PRODUTO FROM @TAB_SEM_EAN_PC)
		AND TEMP.COD_PRODUTO NOT IN (SELECT DISTINCT COD_PRODUTO FROM [192.168.0.6].ZEUS_RTG.DBO.TAB_PRODUTO)
		AND PROD.ITEMID IS NOT NULL
UNION ALL
-- --------------------------------------------------------------------------------------------------------------------
-- FORA DE LINHA E FORA DO ZEUS [EAN = PLU]
-- --------------------------------------------------------------------------------------------------------------------
	SELECT DISTINCT
		TEMP.COD_PRODUTO
		,TEMP.ITEMNAME
		,TEMP.PROIBIDO_COMPRA
		--,PROD.ITEMID
		--,PROD.ITEMNAME
		,'FORA DE LINHA E FORA DO ZEUS [EAN = PLU]'
	FROM
		@TAB_SEM_EAN_PC AS TEMP --LEFT JOIN SMA_AX50_SP1_DB_PROD.dbo.INVENTTABLE AS PROD ON (TEMP.ITEMNAME = PROD.ITEMNAME AND TEMP.COD_PRODUTO <> PROD.ITEMID)
	WHERE 1 = 1
		AND TEMP.PROIBIDO_COMPRA = 'S'
		AND TEMP.COD_PRODUTO NOT IN (SELECT DISTINCT COD_PRODUTO FROM [192.168.0.6].ZEUS_RTG.DBO.TAB_PRODUTO)
UNION ALL
-- --------------------------------------------------------------------------------------------------------------------
-- LINHA E FORA DO ZEUS [EAN = PLU]
-- --------------------------------------------------------------------------------------------------------------------
	SELECT DISTINCT
		TEMP.COD_PRODUTO
		,TEMP.ITEMNAME
		,TEMP.PROIBIDO_COMPRA
		--,PROD.ITEMID
		--,PROD.ITEMNAME
		,'LINHA E FORA DO ZEUS [EAN = PLU]'
	FROM
		@TAB_SEM_EAN_PC AS TEMP --LEFT JOIN SMA_AX50_SP1_DB_PROD.dbo.INVENTTABLE AS PROD ON (TEMP.ITEMNAME = PROD.ITEMNAME AND TEMP.COD_PRODUTO <> PROD.ITEMID)
	WHERE 1 = 1
		AND TEMP.PROIBIDO_COMPRA = 'N'
		AND TEMP.COD_PRODUTO NOT IN (SELECT DISTINCT COD_PRODUTO FROM [192.168.0.6].ZEUS_RTG.DBO.TAB_PRODUTO)
UNION ALL
-- --------------------------------------------------------------------------------------------------------------------
-- LINHA E no ZEUS [EAN = PLU]
-- --------------------------------------------------------------------------------------------------------------------
	SELECT DISTINCT
		TEMP.COD_PRODUTO
		,TEMP.ITEMNAME
		,TEMP.PROIBIDO_COMPRA
		--,PROD.ITEMID
		--,PROD.ITEMNAME
		,'LINHA E no ZEUS [EAN = PLU]'
	FROM
		@TAB_SEM_EAN_PC AS TEMP --LEFT JOIN SMA_AX50_SP1_DB_PROD.dbo.INVENTTABLE AS PROD ON (TEMP.ITEMNAME = PROD.ITEMNAME AND TEMP.COD_PRODUTO <> PROD.ITEMID)
	WHERE 1 = 1
		AND TEMP.PROIBIDO_COMPRA = 'N'
		AND TEMP.COD_PRODUTO IN (SELECT DISTINCT COD_PRODUTO FROM [192.168.0.6].ZEUS_RTG.DBO.TAB_PRODUTO)


/*
SELECT
*
from
	AX2009_INTEGRACAO.dbo.vw_MARCHE_PRODUTO_SITUACAO AS PS INNER JOIN  SMA_AX50_SP1_DB_PROD.dbo.INVENTTABLE AS PROD ON (PS.ITEMID = PROD.itemid)
WHERE 1 = 1
	AND PS.COD_PRODUTO = 00999687
*/